# 開発環境用のDockerfile
FROM python:3.13-slim

WORKDIR /app

# uvのインストール
COPY --from=ghcr.io/astral-sh/uv:0.7.3 /uv /bin/uv

# システムパッケージの更新
RUN apt-get update && \
    apt-get upgrade -y && \
    apt-get install -y --no-install-recommends \
    curl \
    git && \
    apt-get clean && \
    rm -rf /var/lib/apt/lists/*

# 依存関係ファイルをコピー
COPY pyproject.toml uv.lock* ./

# 環境変数を設定
ENV PATH="/app/.venv/bin:$PATH" \
    PYTHONUNBUFFERED=1 \
    PYTHONDONTWRITEBYTECODE=1

# デフォルトコマンド
CMD ["sh", "-c", "uv sync && uv run uvicorn src.main:app --host 0.0.0.0 --port 8000 --reload --reload-exclude '.venv/*' --reload-exclude 'tests/*'"]
